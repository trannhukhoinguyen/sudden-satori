---
import Layout from "../../layouts/Layout.astro";
import "@/styles/badge.css";
import { TAG_MAP } from "../../utils/getMarkdownContent";

export async function getStaticPaths() {
  return Object.entries(TAG_MAP).map(([tag, { posts }]) => {
    const tagSlug = tag.toLowerCase().replace(/[\/\s]+/g, "-");
    return {
      params: { tag: tagSlug },
      props: { tag, posts }
    };
  });
}

const { tag, posts } = Astro.props;
const base = import.meta.env.BASE_URL;
const title = "Tag";
const description = `Tất cả bài viết gắn tag ${tag}`;
---

<Layout title={tag} description={description} showSidebar={true}>
  <div class="badge-page">
    <header class="page-header">
      <h1 class="page-title">{tag}</h1>
      <p class="page-description">{posts.length} bài viết có tag này</p>
      <hr class="page-rule" />
    </header>

    <div class="posts-list">
      {posts.map((post: any) => (
          <article class="post-item">
            <h2 class="post-title">
              <a href={`${base}${post.frontmatter.type}/${post.file.split('/').pop()?.replace(/\.(md|mdx)$/, '')}`}>
                {post.frontmatter.title}
              </a>
            </h2>
            <div class="post-meta">
              <time datetime={post.frontmatter.date}>
                {new Date(post.frontmatter.date).toLocaleDateString("vi-VN", {
                  year: "numeric", month: "long", day: "numeric"
                })}
              </time>
            </div>
            {post.frontmatter.excerpt && <p class="post-excerpt">{post.frontmatter.excerpt}</p>}
          </article>
      ))}
    </div>

    <div class="page-navigation">
      <a href={`${base}tags`} class="back-link">← Xem tất cả Tags</a>
    </div>
  </div>
</Layout>
