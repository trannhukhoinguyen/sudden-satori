---
import Layout from "../../layouts/Layout.astro";
import "@/styles/category.css";
import { CATEGORY_MAP } from "../../utils/getMarkdownContent";

export async function getStaticPaths() {
  return Object.entries(CATEGORY_MAP).map(([category, { posts }]) => {
    const categorySlug = category.toLowerCase().replace(/[\/\s]+/g, "-");
    return {
      params: { category: categorySlug },
      props: { category, posts }
    };
  });
}

const { category, posts } = Astro.props;
const base = import.meta.env.BASE_URL;
const title = "Category";
const description = `Tất cả bài viết về ${category}`;
---

<Layout title={category} description={description} showSidebar={true}>
  <div class="category-page">
    <header class="page-header">
      <h1 class="page-title">{category}</h1>
      <p class="page-description">{posts.length} bài viết trong category này</p>
      <hr class="page-rule" />
    </header>

    <div class="posts-list">
      {posts.map((post: any) => (
          <article class="post-item">
            <h2 class="post-title">
              <a href={`${base}${post.frontmatter.type}/${post.file.split('/').pop()?.replace(/\.(md|mdx)$/, '')}`}>
                {post.frontmatter.title}
              </a>
            </h2>
            <div class="post-meta">
              <time datetime={post.frontmatter.date}>
                {new Date(post.frontmatter.date).toLocaleDateString("vi-VN", {
                  year: "numeric", month: "long", day: "numeric"
                })}
              </time>
            </div>
            {post.frontmatter.excerpt && <p class="post-excerpt">{post.frontmatter.excerpt}</p>}
          </article>
      ))}
    </div>

    <div class="page-navigation">
      <a href={`${base}categories`} class="back-link">← Xem tất cả Categories</a>
    </div>
  </div>
</Layout>
