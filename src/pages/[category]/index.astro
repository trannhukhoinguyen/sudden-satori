---
import Layout from "../../layouts/Layout.astro";
import "@/styles/postList.css";
import { configNew as config } from "../../config";
import { getCategoryData } from "../../utils/getMarkdownContent";
import Pagination from "../../components/Pagination.astro";

export async function getStaticPaths() {
  const { postsPerPage } = config;

  return config.collections.map((category) => {
    const { posts } = getCategoryData(category);
    const totalPages = Math.ceil(posts.length / postsPerPage);

    return {
      params: { category },
      props: {
        category,
        page: 1,
        totalPages,
        posts: posts.slice(0, postsPerPage),
      },
    };
  });
}

const { category, page, totalPages, posts } = Astro.props;
const categoryName = config.categoryNames[category] || category;
---

<Layout
    title={`${category} - Trang ${page} / ${totalPages}`}

>
  <h1>{categoryName}</h1>
  <ul>
    {posts.map((post) => (
        <li>
          <a href={`/${category}/${post.file.split('/').pop()?.replace(/\.(md|mdx)$/, '')}`}>
            {post.frontmatter.title}
          </a>
        </li>
    ))}
  </ul>

  <Pagination {category} {page} {totalPages} />
</Layout>