---
import Layout from "../../layouts/Layout.astro";
import "@/styles/postList.css";
import { configNew as config } from "../../config";
import { getCategoryData } from "../../utils/getMarkdownContent";
import Pagination from "../../components/Pagination.astro";

export async function getStaticPaths() {
  const { postsPerPage } = config;

  const allPaths: any[] = [];

  config.collections.forEach((category) => {
    const { posts } = getCategoryData(category);
    const totalPages = Math.ceil(posts.length / postsPerPage);

    for (let i = 1; i <= totalPages; i++) {
      allPaths.push({
        params: { category, page: i.toString() },
        props: {
          category,
          page: i,
          totalPages,
          posts: posts.slice((i - 1) * postsPerPage, i * postsPerPage),
        },
      });
    }
  });

  return allPaths;
}

const { category, page, totalPages, posts } = Astro.props;
const categoryName = config.categoryNames[category] || category;
---

<Layout title={`${categoryName} - Trang ${page} / ${totalPages}`}>
  <h1>{categoryName}</h1>
  <ul>
    {posts.map((post) => (
        <li>
          <a href={`/${category}/${post.file.split('/').pop()?.replace(/\.(md|mdx)$/, '')}`}>
            {post.frontmatter.title}
          </a>
        </li>
    ))}
  </ul>

  <Pagination {category} {page} {totalPages} />
</Layout>