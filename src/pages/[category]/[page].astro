---
import Layout from "../../layouts/Layout.astro";
import { configNew as config } from "../../config";
import { getCategoryData } from "../../utils/getMarkdownContent";

const postsPerPage = 5;

export async function getStaticPaths() {
  const allPaths: any[] = [];

  config.collections.forEach((category) => {
    const { posts } = getCategoryData(category);
    const totalPages = Math.ceil(posts.length / postsPerPage);

    for (let i = 1; i <= totalPages; i++) {
      allPaths.push({
        params: { category, page: i.toString() },
        props: {
          category,
          page: i,
          totalPages,
          posts: posts.slice((i - 1) * postsPerPage, i * postsPerPage),
        },
      });
    }
  });

  return allPaths;
}

const { category, page, totalPages, posts } = Astro.props;
---

<Layout title={`${category} - Page ${page}`}>
  <h1>{category} - Page {page} / {totalPages}</h1>
  <ul>
    {posts.map((post) => (
      <li>
        <a href={`/${category}/${post.file.split('/').pop()?.replace(/\.(md|mdx)$/, '')}`}>
          {post.frontmatter.title}
        </a>
      </li>
    ))}
  </ul>

  <nav>
    {page > 1 && <a href={`/${category}/${page - 1}`}>← Prev</a>}
    {page < totalPages && <a href={`/${category}/${page + 1}`}>Next →</a>}
  </nav>
</Layout>
