---
import Layout from "../../layouts/Layout.astro";
import Pagination from "../../components/Pagination.astro";
import { CONTENT_MAP } from "../../utils/getMarkdownContent";
import { configNew as config } from "../../config";

export async function getStaticPaths() {
  return Object.keys(CONTENT_MAP).map((collection) => {
    const posts = CONTENT_MAP[collection].posts;
    return {
      params: { field: collection },
      props: {
        collection,
        posts,
        page: 1,
        totalPages: Math.ceil(posts.length / config.postsPerPage),
      },
    };
  });
}

const { collection, posts, page, totalPages } = Astro.props;
const base = import.meta.env.BASE_URL;
const title = `Danh sách: ${collection}`;
---

<Layout title={title} description={`Danh sách bài viết trong ${collection}`}>
  <h1>{title}</h1>

  <div class="posts-list">
    {posts.slice(0, config.postsPerPage).map((post: any) => (
        <article class="post-item">
          <h2>
            <a href={`${base}${collection}/${post.file.split("/").pop()?.replace(/\.(md|mdx)$/, "")}`}>
              {post.frontmatter.title}
            </a>
          </h2>
          <time datetime={post.frontmatter.date}>
            {new Date(post.frontmatter.date).toLocaleDateString("vi-VN", {
              year: "numeric",
              month: "long",
              day: "numeric",
            })}
          </time>
        </article>
    ))}
  </div>

  <Pagination currentPage={page} totalPages={totalPages} baseUrl={`${base}${collection}`} />
</Layout>
