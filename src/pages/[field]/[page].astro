---
import Layout from "../../layouts/Layout.astro";
import Pagination from "../../components/Pagination.astro";
import { CONTENT_MAP } from "../../utils/getMarkdownContent";
import { configNew as config } from "../../config";

export async function getStaticPaths() {
  return Object.entries(CONTENT_MAP).flatMap(([collection, data]) => {
    const posts = data.posts;
    const totalPages = Math.ceil(posts.length / config.postsPerPage);

    return Array.from({ length: totalPages }, (_, i) => ({
      params: { category: collection, page: String(i + 1) },
      props: {
        collection,
        posts,
        page: i + 1,
        totalPages,
      },
    }));
  });
}

const { collection, posts, page, totalPages } = Astro.props;
const base = import.meta.env.BASE_URL;
const title = `Danh sách: ${collection} (Trang ${page})`;
---

<Layout title={title} description={`Trang ${page} của ${collection}`}>
  <h1>{title}</h1>

  <div class="posts-list">
    {posts
        .slice((page - 1) * config.postsPerPage, page * config.postsPerPage)
        .map((post: any) => (
            <article class="post-item">
              <h2>
                <a href={`${base}${collection}/${post.file.split("/").pop()?.replace(/\.(md|mdx)$/, "")}`}>
                  {post.frontmatter.title}
                </a>
              </h2>
              <time datetime={post.frontmatter.date}>
                {new Date(post.frontmatter.date).toLocaleDateString("vi-VN", {
                  year: "numeric",
                  month: "long",
                  day: "numeric",
                })}
              </time>
            </article>
        ))}
  </div>

  <Pagination currentPage={page} totalPages={totalPages} baseUrl={`${base}${collection}`} />
</Layout>
