---
import "@/styles/post.css";
import "@/styles/badgeList.css";
import { CONTENT_MAP } from "../../utils/getMarkdownContent";
import Layout from "../../layouts/Layout.astro";
import TOC from "../../components/post/TOC.astro";
import FloatingTOC from "../../components/post/FloatingTOC.astro";
import MediaArea from "../../components/post/MediaArea.astro";
import Breadcrumbs from "../../components/Breadcrumbs.astro";
import PostHeader from "../../components/post/PostHeader.astro";
import PostTags from "../../components/post/PostTags.astro";
import PostReadAll from "../../components/post/PostReadAll.astro";

export async function getStaticPaths() {
  return Object.entries(CONTENT_MAP).flatMap(([collection, data]) =>
      data.posts.map((post: any) => {
        return {
          params: {
            field: collection,
            slug: post.file.split("/").pop()?.replace(/\.(md|mdx)$/, ""),
          },
          props: { post, collection },
        };
      })
  );
}

const { post, collection } = Astro.props;
const { frontmatter, Content } = post as any;
---

<Layout
    title={frontmatter.title}
    description={frontmatter.description || frontmatter.excerpt}
    type="article"
    publishedTime={frontmatter.date ? new Date(frontmatter.date).toISOString() : undefined}
    collection={collection}
>
  <!-- ✅ Breadcrumbs -->
  <Breadcrumbs collection={collection} title={post.frontmatter.title} />

  <article class="blog-post">
    <!-- ✅ PostHeader -->
    <PostHeader post={post} />

    <!-- ✅ TOC -->
    <TOC post={post} />
    <FloatingTOC post={post} />

    <div class="post-content">
      <!-- ✅ Video, Audio -->
      <MediaArea frontmatter={frontmatter} />
    </div>

    <div class="post-content">
      <!-- ✅ Content -->
      <Content />
    </div>
  </article>

  <footer class="post-footer">
    <!-- ✅ Tags -->
    <PostTags frontmatter={frontmatter} />

    <PostReadAll collection={collection} />
  </footer>

</Layout>
