---
import "@/styles/post/boxedPostList.css";
import {config} from "../../config";
import PostExcerpt from "../post/PostExcerpt.astro";
import PostImage from "../post/PostImage.astro";

const { posts } = Astro.props;

const categoryName = config.categoryNames[posts[0].frontmatter.type as keyof typeof config.categoryNames] || posts[0].frontmatter.type;
const groupsBySpecialTag = posts?.reduce((acc: string[], post: any) => {
        const tag = post.frontmatter.tags?.[0];
        if (tag && !acc.includes(tag)) acc.push(tag);
        return acc;
}, []);
const groupsSorted = [
    groupsBySpecialTag.find((group: string) => group === 'Giá»›i thiá»‡u'),
    groupsBySpecialTag.find((group: string) => group === 'ChÆ°a phÃ¢n loáº¡i'),
    ...groupsBySpecialTag.filter((group: string) => !['Giá»›i thiá»‡u', 'ChÆ°a phÃ¢n loáº¡i'].includes(group)),
];
const postsGroupedBySpecialTag = groupsSorted
    ?.filter((group: string | undefined): group is string => !!group) // bá» undefined
    ?.map((group: string) => ({
            group: group,
            postsGrouped: posts.filter((post: any) => post.frontmatter.tags[0] === group),
        }))
    .filter((g) => g.postsGrouped.length > 0); // bá» group khÃ´ng cÃ³ bÃ i;
---

{
    posts.length > 0 ? (
        postsGroupedBySpecialTag?.map((postGroupedBySpecialTag: any, index: number) => <h2 class="boxed-post-list-title-medium">
            {
                postGroupedBySpecialTag.group === 'Giá»›i thiá»‡u'
                    ? 'ðŸ“š'
                    : postGroupedBySpecialTag.group === 'ChÆ°a phÃ¢n loáº¡i'
                        ? 'ðŸ““'
                        : index%2 === 0
                            ? 'ðŸ“™'
                            : 'ðŸ“’'
            }
            {postGroupedBySpecialTag.group}
        </h2>
        <div class="boxed-post-list">
            {postGroupedBySpecialTag.postsGrouped?.map((post: any) => {
                return (
                    <article class="boxed-post-card">
                        <h4 class="boxed-post-title">
                            <a href={`/${post.frontmatter.type}/${post.file.split("/").pop()?.replace(/\.(md|mdx)$/, "")}`}>
                                {post.frontmatter.title}
                            </a>
                        </h4>

                        <!-- Image Section -->
                        <section class="image-area">
                            <PostImage imageUrl={post.frontmatter.image} imageAlt={post.frontmatter.title} height="200px" />
                        </section>

                        <div class="boxed-post-meta">
                            <PostExcerpt frontmatter={post.frontmatter} />
                        </div>
                    </article>
                )
            })}
        </div>)

    ) : <p>ChÆ°a cÃ³ bÃ i viáº¿t {categoryName} nÃ o.</p>
}
