---
import { CONTENT_MAP } from "../../utils/getMarkdownContent";
import {config} from "../../config";
import PostExcerpt from "../../components/post/PostExcerpt.astro";

const { tags, type, notIncludedPostTitle } = Astro.props;
const base = import.meta.env.BASE_URL;

const posts = Object.entries(CONTENT_MAP)
    .flatMap(([collection, data]) => data.posts)
    .filter(post => post?.frontmatter.tags.every((tag: string) => tags?.includes(tag)))
    .filter(post => post?.frontmatter.title !== notIncludedPostTitle);

const categoryName = config.categoryNames[type as keyof typeof config.categoryNames] || type;
---


{
    posts.length > 0 ? (
      <hr class="blog-rule" />
      <h2 class="blog-title-medium">{categoryName} liÃªn quan</h2>
      <div class="related-posts">
        {posts.slice(0, config.postsPerPage).map((post: any) => {
          return (
              <article class="related-post-card">
                <h4 class="related-post-title">
                  <a href={`${base}${post.frontmatter.type}/${post.file.split("/").pop()?.replace(/\.(md|mdx)$/, "")}`}>
                    {post.frontmatter.title}
                  </a>
                </h4>

                <div class="related-post-meta">
                  <PostExcerpt frontmatter={post.frontmatter} />
                </div>
              </article>
          )
        })}
      </div>
    ) : ''
}


<style>
  .blog-title-medium {
    color: var(--color-accent-gold);
  }

  .related-posts {
    display: grid;
    gap: calc(var(--grid-unit) * 4);
    margin-bottom: calc(var(--grid-unit) * 6);
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  }

  .related-post-card {
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: calc(var(--grid-unit) * 3);
    transition: transform 0.2s ease, border-color 0.2s ease;
  }

  .related-post-card:hover {
    transform: translateY(-2px);
    border-color: var(--color-accent-gold);
  }

  .related-post-title {
    font-family: var(--font-heading-secondary),serif;
    font-weight: 600;
    margin-bottom: calc(var(--grid-unit));
  }

  .related-post-title a {
    color: var(--color-text-primary);
    text-decoration: none;
  }

  .related-post-title a:hover,
  .related-post-title a:focus {
    color: var(--color-accent-gold);
  }

  .related-post-meta {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: calc(var(--grid-unit));
    margin-bottom: calc(var(--grid-unit) * 1.5);
  }
</style>
