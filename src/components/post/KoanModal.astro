---
const { id = "koan", label = "XEM BÌNH XƯỚNG" } = Astro.props;
---

<button
  id={`openModalBtn-${id}`}
  class="px-3 py-2 rounded bg-sky-600 text-white hover:bg-sky-700 focus:outline-none focus:ring"
>
  Mở modal
</button>

<div id={`modal-${id}`} class="fixed inset-0 z-50 hidden" aria-hidden="true">
  <div id={`modalBackdrop-${id}`} class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>

  <div class="fixed inset-0 flex items-center justify-center p-4">
    <div
      id={`modalDialog-${id}`}
      class="max-w-lg w-full bg-white dark:bg-slate-800 rounded-2xl shadow-2xl overflow-hidden transform transition-all scale-95 opacity-0"
    >
      <div class="p-6">
        <h2 class="text-xl font-semibold mb-2">LÀ CÁI GÌ?</h2>
        <p class="text-sm text-slate-600 dark:text-slate-300 mb-6">
          Bấm nút dưới để xem phần bình xướng của công án này.
        </p>
        <div class="flex justify-end gap-3">
          <button
            id={`backBtn-${id}`}
            class="px-4 py-2 rounded-md border border-slate-300 dark:border-slate-700 text-slate-700 dark:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 focus:outline-none focus:ring"
          >
            QUAY LẠI
          </button>
          <button
            id={`viewBtn-${id}`}
            class="px-4 py-2 rounded-md bg-emerald-600 text-white hover:bg-emerald-700 focus:outline-none focus:ring"
          >
            {label}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="module">
  const id = Astro.props.id;
  const openBtn = document.getElementById(`openModalBtn-${id}`);
  const modal = document.getElementById(`modal-${id}`);
  const dialog = document.getElementById(`modalDialog-${id}`);
  const backdrop = document.getElementById(`modalBackdrop-${id}`);
  const backBtn = document.getElementById(`backBtn-${id}`);
  const viewBtn = document.getElementById(`viewBtn-${id}`);
  const binhXuong = document.getElementById(`binhXuong-${id}`);

  function showModal() {
    modal.classList.remove('hidden');
    requestAnimationFrame(() => {
      dialog.classList.remove('scale-95', 'opacity-0');
      dialog.classList.add('scale-100', 'opacity-100');
    });
  }

  function hideModal() {
    dialog.classList.add('scale-95', 'opacity-0');
    setTimeout(() => modal.classList.add('hidden'), 150);
  }

  openBtn?.addEventListener('click', showModal);
  backBtn?.addEventListener('click', hideModal);
  backdrop?.addEventListener('click', hideModal);
  viewBtn?.addEventListener('click', () => {
    hideModal();
    binhXuong?.classList.remove('hidden');
    binhXuong?.scrollIntoView({ behavior: 'smooth' });
  });
</script>
