---
import {
    upcomingEvents,
    cyclicalEvents,
} from '@/data/events/upcoming-events';
import { getTodayLunar } from '@/utils/lunar';
import { getTodayLunarEvents } from '@/utils/filterLunarEvents';

const lunarToday = getTodayLunar();
const todayEvents = getTodayLunarEvents(cyclicalEvents, lunarToday);

const { events = [] } = Astro.props;
---

<section class="retreat-slider" data-retreat-slider>
    <ul class="slider-track">
        {todayEvents.map((event) => (
                <li class="slide">
                    <span class="title">{event.title}</span>
                    <span class="time">
                      {event.schedule} · {event.note}
                    </span>
                </li>
        ))}

        <!-- duplicate để scroll vô hạn -->
        {todayEvents.map((event) => (
                <li class="slide clone">
                    <span class="title">{event.title}</span>
                    <span class="time">
                      {event.schedule} · {event.note}
                    </span>
                </li>
        ))}
    </ul>
</section>

<style>
.retreat-slider {
    overflow: hidden;
    padding: 0.75rem 0;
    border-top: 1px solid rgba(0,0,0,0.05);
    border-bottom: 1px solid rgba(0,0,0,0.05);
    }

.slider-track {
    display: flex;
    gap: 2.5rem;
    will-change: transform;
    }

.slide {
    white-space: nowrap;
    font-size: 0.9rem;
    opacity: 0.8;
    }

.slide .title {
    font-weight: 500;
    }

.slide .time {
    margin-left: 0.5rem;
    opacity: 0.6;
    }
</style>

<script type="module">
    const slider = document.querySelector('[data-retreat-slider]');
    if (!slider) return;

    const track = slider.querySelector('.slider-track');
    let offset = 0;

    const speed = 0.3; // CÀNG NHỎ CÀNG "THIỀN"

    function animate() {
        offset += speed;
        track.style.transform = `translateX(-${offset}px)`;

        if (offset >= track.scrollWidth / 2) {
            offset = 0;
        }

        requestAnimationFrame(animate);
    }

    requestAnimationFrame(animate);
</script>
