---
const { speechUrl = "", title } = Astro.props;
---

<style>
    .speech-modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; z-index: 1000; }
    .speech-modal { background: white; border-radius: 8px; width: 90%; max-width: 900px; height: 90%; display: flex; flex-direction: column; }
    .speech-modal-header { display: flex; justify-content: space-between; padding: 0.5rem 1rem; border-bottom: 1px solid #ddd; }
    .speech-modal-content { flex: 1; overflow: auto; padding: 1rem; }
    iframe { flex: 1; border: none; }
</style>

<button id="speech-trigger" title={title}>üìë</button>

<div class="speech-modal-overlay" id="speech-modal" style="display:none;">
    <div class="speech-modal">
        <div class="speech-modal-header">
            <span>Xem <b>{title}</b></span>
            <div>
                <a href={speechUrl} target="_blank" rel="noopener">
                    <button>M·ªü tab m·ªõi</button>
                </a>
                {speechUrl && (
                        <>
                            <a href={speechUrl} download><button>T·∫£i v·ªÅ</button></a>
                            <button id="speech-print">In</button>
                        </>
                )}
                <button id="speech-close">‚úñ</button>
            </div>
        </div>

        {speechUrl ? (
                <iframe src={speechUrl}></iframe>
        ) : (
                <div class="speech-modal-content" id="speech-content">‚è≥ ƒêang t·∫£i...</div>
        )}
    </div>
</div>

<script>
    const trigger = document.getElementById("speech-trigger");
    const modal = document.getElementById("speech-modal");
    const closeBtn = document.getElementById("speech-close");
    const printBtn = document.getElementById("speech-print");

    trigger?.addEventListener("click", async () => {
        modal.style.display = "flex";
    });

    closeBtn?.addEventListener("click", () => modal.style.display = "none");
    modal?.addEventListener("click", (e) => { if (e.target === modal) modal.style.display = "none"; });

    printBtn?.addEventListener("click", () => {
        const iframe = document.querySelector("#speech-modal iframe");
        if (iframe instanceof HTMLIFrameElement) {
            iframe.contentWindow?.print();
        } else {
            window.print(); // fallback n·∫øu l√† article text
        }
    });
</script>
