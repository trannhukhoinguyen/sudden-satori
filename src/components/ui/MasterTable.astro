---
import masterData from "../../data/masters/AllMasterDb.tsx";
---

<section class="table">
  <h2 class="title-accent-centered">BẢNG DANH SÁCH THIỀN SƯ</h2>

  <div class="toolbox"                                                                                                                  >
    <input type="text" id="inpValue" placeholder="Type here to filter the table below by name or country.." />
    <button id="btnClear">Clear (hoặc click ESC)</button>

<!--    <div class="control-panel">

      <label class="label"><input id="rbName" type="checkbox" name="checkbox" checked/>
        India</label>

      <label class="label"><input id="rbCountry" type="checkbox" name="checkbox" />
        China</label>

      <label class="label"><input id="cbCaseSns" type="checkbox" name="checkbox" />
        Japan</label>

      <label class="label"><input id="rbCountry" type="checkbox" name="checkbox" />
        Vietnam</label>

      <label class="label"><input id="cbCaseSns" type="checkbox" name="checkbox" />
        Korea</label>

    </div>-->
  </div>

  <table>
    <thead>
    <tr>
      <th class="table-head">ID</th>
      <th class="table-head">Tên</th>
      <th class="table-head">Tên Việt</th>
      <th class="table-head">Nước</th>
      <th class="table-head">Thầy</th>
    </tr>
    </thead>
    <tbody>

    {
        masterData?.length
        && masterData?.map((master: any) => <tr>
          <td data-label="ID" class="table-data">{ master.id }</td>
          <td data-label="Tên" class="table-data">{ master.name_en }</td>
          <td data-label="Tên Việt" class="table-data">{ master.name_vi }</td>
          <td data-label="Nước" class="table-data">{ master.country }</td>
          <td data-label="Thầy" class="table-data">{ master.teachers?.join(', ') }</td>
        </tr>)
    }

    </tbody>
  </table>

  <div class="pagination" id="pagination"></div>
</section>

<style>
.table {
  position: relative;
  font-family: sans-serif;
  padding: 4px;
  overflow: scroll;

  .toolbox {
    text-align: center;
    padding: 5px;
    background-color: #f9f9f9;
    border: 1px solid #ddd;
    border-radius: 2px;
    margin-bottom: 20px;
  }

  .info-panel p {
    font-size: 12px;
  }

  a {
    text-decoration: none;
    font-size: 12px;
  }

  #inpValue {
    width: 90%;

    margin: 10px 2px 2px 10px;
    padding: 5px;
    border: 1px solid #eee;
  }

  .control-panel {
    padding: 5px;
  }

  label {
    display: inline-block;
    color: var(--color-accent-maroon);
  }

  table {
    width: 100%;
    border-collapse: collapse;
    border: 1px solid #ddd;
    text-align: left;
  }

  th {
    background-color: var(--color-text-title-accent);
    padding: 5px;
    color: var(--color-accent-maroon);
  }

  tr {
    border-bottom: 1px solid #ddd;
  }

  tr th:first-child {
    //width: 70%;
  }

  td {
    padding: 5px;
  }

  .pagination button {
    margin: 3px;
    padding: 5px 8px;
    cursor: pointer;
    border: 1px solid #ddd;
    background: #f9f9f9;
  }

  .pagination button.active {
    background: #cc9c04;
    color: white;
  }

  #pagination .dots {
      display: flex;
      align-items: center;
      padding: 0 6px;
      color: #777;
      font-weight: 600;
      user-select: none;
  }
    #pagination {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;                 /* khoảng cách giữa các nút */
        margin-top: 16px;
        justify-content: center;  /* căn giữa */
    }

    #pagination button {
        min-width: 44px;          /* chuẩn touch mobile */
        height: 44px;
        padding: 0 12px;

        border-radius: 6px;
        border: 1px solid #ccc;

        background: #fff;
        color: #333;

        font-size: 14px;
        font-weight: 500;

        cursor: pointer;
        transition: all 0.2s ease;
    }

    /* Hover */
    #pagination button:hover {
        background: #f0f0f0;
    }

    /* Active page */
    #pagination button.active {
        background: #007bff;
        color: #fff;
        border-color: #007bff;
    }

    /* Disabled (nếu có dùng Prev / Next) */
    #pagination button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    @media (max-width: 480px) {
        #pagination {
            gap: 10px;
        }

        #pagination button {
            min-width: 48px;
            height: 48px;
            font-size: 15px;
        }
    }
}
</style>

<script is:inline>
  // ===== Controls =====
  const btnClear = document.getElementById("btnClear");
  const inpValue = document.getElementById("inpValue");

  // ===== Table rows =====
  const table = document.querySelector("table tbody");
  const rows = Array.from(table.querySelectorAll("tr"));

  // ===== Pagination =====
  const rowsPerPage = 10;
  let currentPage = 1;

  // ===== Events =====
  btnClear.addEventListener("click", () => {
    inpValue.value = "";
  });

  inpValue.addEventListener("keyup", e => {
    if (e.key === "Escape") inpValue.value = "";
  });

  // ===== Pagination logic =====
  function paginate() {
    const matchedRows = rows.filter(r => r.dataset.match === "true");
    const pageCount = Math.ceil(matchedRows.length / rowsPerPage);

    // hide all
    rows.forEach(r => (r.style.display = "none"));

    // show current page
    const start = (currentPage - 1) * rowsPerPage;
    const end = start + rowsPerPage;

    matchedRows.slice(start, end).forEach(r => {
      r.style.display = "";
    });

    buildPagination(pageCount);
  }

  // ===== Pagination buttons =====
  function buildPagination(pageCount) {
    const paginationEl = document.getElementById("pagination");
    paginationEl.innerHTML = "";

    if (pageCount <= 1) return;

    const maxVisible = 5;
    const half = Math.floor(maxVisible / 2);

    let start = Math.max(2, currentPage - half);
    let end = Math.min(pageCount - 1, currentPage + half);

    // Điều chỉnh khi gần đầu
    if (currentPage <= half + 1) {
      start = 2;
      end = Math.min(pageCount - 1, maxVisible + 1);
    }

    // Điều chỉnh khi gần cuối
    if (currentPage >= pageCount - half) {
      start = Math.max(2, pageCount - maxVisible);
      end = pageCount - 1;
    }

    // Page 1
    addPageButton(1);

    // Dấu ...
    if (start > 2) addDots();

    // Các page giữa
    for (let p = start; p <= end; p++) {
      addPageButton(p);
    }

    // Dấu ...
    if (end < pageCount - 1) addDots();

    // Page cuối
    addPageButton(pageCount);

    // ===== helpers =====
    function addPageButton(page) {
      const btn = document.createElement("button");
      btn.textContent = page;
      if (page === currentPage) btn.classList.add("active");

      btn.addEventListener("click", () => {
        currentPage = page;
        paginate();
      });

      paginationEl.appendChild(btn);
    }

    function addDots() {
      const span = document.createElement("span");
      span.textContent = "…";
      span.className = "dots";
      paginationEl.appendChild(span);
    }
  }


  // ===== Init =====
  rows.forEach(r => (r.dataset.match = "true"));
  paginate();
</script>

