---

---

<!-- Include this in your Astro layout, e.g. src/layouts/Base.astro -->
<script>
  const KOAN_KEY = 'koan_selected_question';
  const KOAN_SUPPRESS = 'koan_suppress_until';

  const koans = [
    'Khi chưa có trời đất, ta là cái gì?',
    'Muôn pháp về một, một về chỗ nào?',
    'Trước khi cha mẹ chưa sanh, mặt mũi bổn lai của ta ra sao?',
    'Sanh từ đâu đến, chết đi về đâu?',
    'Chẳng phải tâm, chẳng phải Phật, chẳng phải vật, là cái gì?',
    'Chẳng cùng muôn pháp làm bạn là người gì?'
  ];

  function shouldSuppress() {
    const ts = localStorage.getItem(KOAN_SUPPRESS);
    if (!ts) return false;
    return Date.now() < Number(ts);
  }

  function showInitialModal() {
    const wrapper = document.createElement('div');
    wrapper.innerHTML = `
      <div style="position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:9999;">
        <div style="background:white;padding:20px;border-radius:12px;max-width:450px;width:90%;">
          <h3>Chọn một câu thoại đầu</h3>
          <form id="koan-form">
            ${koans.map((k,i)=>`<label class="tag-line-accent" style='display:block;margin:8px 0'>
              <input required type='radio' name='koan' value='${i}'> ${k}
            </label>`).join('')}
            <button type="submit" style="margin-top:12px;width:100%;padding:8px;">OK</button>
          </form>
        </div>
      </div>`;
    document.body.appendChild(wrapper);

    wrapper.querySelector('#koan-form').addEventListener('submit', e => {
      e.preventDefault();
      const index = wrapper.querySelector('input[name="koan"]:checked').value;
      localStorage.setItem(KOAN_KEY, index);
      wrapper.remove();
    });
  }

  function showReminderModal(koanIndex) {
    const wrapper = document.createElement('div');
    wrapper.innerHTML = `
      <div style="position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:9999;">
        <div style="background:white;padding:20px;border-radius:12px;max-width:450px;width:90%;">
          <h2 class="tag-line-accent" style="color: red"><strong>${koans[koanIndex]}</strong></h2>
          <p style="color: red">NHỚ CHIẾU CỐ THOẠI ĐẦU (Hỏi & Nhìn vào chỗ KHÔNG BIẾT)</p>
          <button id="suppress" style="margin-top:12px;width:100%;padding:8px;">Tạm ẩn modal trong 1 giờ tới (Tinh tấn lên!)</button>
          <button id="close" style="margin-top:12px;width:100%;padding:8px;background:darkred;color:white">Đã rõ</button>
        </div>
      </div>`;
    document.body.appendChild(wrapper);

    wrapper.querySelector('#close').onclick = () => wrapper.remove();

    wrapper.querySelector('#suppress').onclick = () => {
      const until = Date.now() + 1 * 60 * 60 * 1000; // 24h
      localStorage.setItem(KOAN_SUPPRESS, until.toString());
      wrapper.remove();
    };
  }

  window.addEventListener('DOMContentLoaded', () => {
    const saved = localStorage.getItem(KOAN_KEY);

    if (!saved) {
      showInitialModal();
      return;
    }

    if (!shouldSuppress()) {
      showReminderModal(Number(saved));
    }
  });
</script>
