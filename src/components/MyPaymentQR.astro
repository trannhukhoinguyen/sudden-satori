---
interface Props {
    momoPhone?: string
    bankCode?: string
    bankAccount?: string
    bankName?: string
    facebookPostUrl?: string
    text?: string
}
const { facebookPostUrl } = Astro.props;
const postWidth = '1000';

const momoQrSrc = "/images/qr/momo.jpg";
const bankQrSrc = "/images/qr/vietinbank.jpg";
const facebookPostSrc = "/images/qr/facebook-post.avif";

const pagodasForOffering = [
    { title: 'Chùa Pháp Thành I', link: '/pagodas/chua-Phap-Thanh-I', description: 'Q.6', },
    { title: 'Chùa Phật Đà', link: '/pagodas/chua-Phat-Da', description: 'Q.3', },
    { title: 'Chùa Thiên Trì', link: '/pagodas/chua-Thien-Tri', description: 'Q. Bình Chánh', },
    { title: 'Chùa Liên Hoa', link: '/pagodas/chua-Lien-Hoa-Q11', description: 'Q.11', },
    { title: 'Chùa Liên Hoa', link: '/pagodas/chua-Lien-Hoa-Binh-Chanh', description: 'Q. Bình Chánh', },
    { title: 'Thiền Viện Duy Lực', link: '/pagodas/thien-vien-Duy-Luc', description: 'Đồng Nai', },
    { title: 'Thiền Tự Quy Sơn', link: '/pagodas/thien-tu-Quy-Son', description: 'BRVT', },
    { title: 'Thiền đường Liễu Quán I', link: '/pagodas/thien-duong-Lieu-Quan-I', description: 'BRVT', },
    { title: 'Chùa Tam Bảo', link: '/pagodas/chua-Tam-Bao', description: 'Đồng Tháp', },
]
---

<style>
    .dynamic-qr-box, .my-qr-box {
        max-width: 100%;
        border: 1px solid #ddd;
        padding: 16px;
        border-radius: 12px;
        font-family: system-ui, sans-serif;
        display: flex;
        gap: 16px;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
    }

        .amount-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 12px 0;
        }
        button {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            cursor: pointer;
            background: #f7f7f7;
        }
        button.submit-button {
            margin-block: 12px;
            background: var(--color-accent-maroon);
            color: white;
            border: none;
            float: right;
        }

        img {
            width: 200px;        /* hoặc 120px / 160px tùy bạn */
            height: auto;
            max-width: 100%;
        }

        .input-label-message {
            margin-block: 12px;
            text-align: center;
        }

        .thank-you-message {
            margin-block: 12px;
            color: var(--color-accent-gold);
            text-align: center;
        }
    }

    .my-qr-box {
        .my-qr-image-area {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
    }

    .donation-section, .donation-info-section, .my-qr-box {
        margin-block: 24px;
        padding-top: 16px;
        border-top: 1px solid #e5e5e5;

        .donation-header h4 {
            margin: 12px;
            font-size: 16px;
            font-weight: 600;
        }

        .donation-header p {
            margin: 12px;
            font-size: 14px;
            color: #555;
            line-height: 1.5;
        }

        .donation-header-title {
            text-align: center;
        }

        .fb-fallback {
            margin-block: 12px;
            font-size: 14px;
            color: #666;
            background: #fafafa;
            padding: 12px;
            border: 1px dashed #ccc;
            border-radius: 6px;
        }

        .fb-fallback a {
            margin-block: 12px;
            color: #000;
            text-decoration: underline;
        }

        .fb-post {
            margin-block: 12px;
        }

        @media (min-width: 480px) {
            .donation-section {
                padding-left: 8px;
                padding-right: 8px;
            }
        }
    }
</style>

<div class="my-qr-box">
    <h3 class="donation-header-title">THÔNG TIN NƠI TIẾP NHẬN CÚNG DƯỜNG</h3>
    <p class="donation-header-title">Các bạn có thể xem thông báo chính thức từ chùa tại bài đăng bên dưới.</p>
    <section class="donation-section">
        <!-- Fallback -->
        <div id="fb-fallback" class="fb-fallback">
            <p>
                Bài viết Facebook đang được tải.
                Nếu không hiển thị, xin vui lòng
                <a href={facebookPostUrl} target="_blank">
                    <h3>xem trực tiếp tại Facebook</h3>
                </a>.
            </p>
            <img src={facebookPostSrc} alt={"Momo"} width="300" height="auto" />
        </div>

        <!-- Facebook embed -->
        <div
                class="fb-post"
                data-href={facebookPostUrl}
                data-show-text="true"
        ></div>
    </section>
</div>

<div class="my-qr-box">
    <section class="donation-info-section">
        <header class="donation-header">
            <h3 class="donation-header-title">MỘT SỐ NGÔI CHÙA TRONG TÔNG PHONG TỔ SƯ THIỀN</h3>
        </header>

        <div class="receiving-info-area">
            <ul>
                {
                    pagodasForOffering
                        ?.map(pagoda =>
                                <li><a
                                        href={pagoda.link}
                                        target="_blank"
                                ><b>{pagoda.title}</b>
                                    - {pagoda.description}
                                </a></li>
                        )
                }
                <li>...</li>
            </ul>
        </div>
    </section>
</div>

<div class="my-qr-box">
    <header class="donation-header">
        <h3 class="donation-header-title">TÀI KHOẢN NHẬN CÚNG DƯỜNG</h3>
    </header>

    <div class="receiving-info-area">
        <p>
            Mọi sự phát tâm ủng hộ, xin Quý vị gửi vào:
            (Xin Quý vị ghi rõ Tên, Pháp danh (nếu có), Phật sự cuối năm hoặc viết tắt PSCN)
        </p>
        <ul>
            <li>Số tài khoản: <b>3618081982</b></li>
            <li>Chủ tài khoản: <b>Phan Ngọc Dao</b> (Ni sư <em>Thích nữ Vạn Hữu</em>)</li>
            <li>Tên ngân hàng: <b>Ngân hàng Quân Đội (MB Bank)</b>, </li>
            <li>Chi nhánh: <b>Phòng giao dịch Quận 6 (cũ)</b></li>
            <li>Trụ trì: Chùa <b>Pháp Thành</b> toạ lạc tại <b>192/32/4, đường Phạm Văn Chí, phường 4, Quận 6</b></li>
        </ul>
    </div>

    <div class="my-qr-image-area">
        <h4>HOẶC</h4>
        <img src={momoQrSrc} alt={"Momo"} width="auto" height="50" />
        <img src={bankQrSrc} alt={"Vietinbank"} width="auto" height="50" />
    </div>

    <h3 class="thank-you-message">XIN CHÂN THÀNH CẢM ƠN!</h3>
</div>

<!--<div class="dynamic-qr-box">
    <h3 class="input-label-message">Nhập số tiền bạn muốn gửi đi nhé!</h3>

    <input
            id="amount"
            type="number"
            placeholder="VD: 50000"
            style="width:100%; padding:10px; font-size:16px"
    />

    <div class="amount-buttons">
        <button data-value="5000">5.000</button>
        <button data-value="10000">10.000</button>
        <button data-value="50000">50.000</button>
        <button data-value="100000">100.000</button>
        <button data-value="200000">200.000</button>
        <button data-value="500000">500.000</button>
    </div>

    <button class="submit-button" id="submit">Tạo QR</button>

    <h3 class="thank-you-message">XIN CHÂN THÀNH CẢM ƠN!</h3>

    <div id="result"></div>
</div>-->

<script>
    const paymentQRProps = {
        momoPhone: "0989784241",

        bankCode: "CTG",
        bankAccount: "107867147195",
        bankName: "Vietinbank"
    };

    const amountInput = document.getElementById("amount") as HTMLInputElement
    const result = document.getElementById("result") as HTMLDivElement

    document.querySelectorAll("[data-value]").forEach(btn => {
        if (btn instanceof HTMLButtonElement) {
            amountInput.value = btn.dataset.value ?? ""
        }
    })

    document.getElementById("submit")!
        .addEventListener("click", () => {
            const amount = Number(amountInput.value)
            if (!amount || amount <= 0) return

            const momoQR = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=momo://?phone=${paymentQRProps.momoPhone}&amount=${amount}`

            const bankQR = `https://img.vietqr.io/image/${paymentQRProps.bankCode}-${paymentQRProps.bankAccount}-qr_only.png?amount=${amount}&addInfo=Thanh%20toan`

            result.innerHTML = `
              <p><strong>MoMo</strong></p>
              <img src="${momoQR}" alt="MoMo QR" />
        
              <p><strong>${paymentQRProps.bankName}</strong></p>
              <img src="${bankQR}" alt="Bank QR" />
            `
        })
</script>

<script is:inline>
if (!document.getElementById("facebook-jssdk")) {
    const script = document.createElement("script")
    script.id = "facebook-jssdk"
    script.src =
        "https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v18.0"
    document.body.appendChild(script)
    }
</script>
