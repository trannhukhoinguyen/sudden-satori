---
import "@/styles/sidebar.css";
import { getCategoryData } from "../utils/getMarkdownContent";

const base = import.meta.env.BASE_URL;

// ✅ Xác định collection hiện tại (blogs, books, sutras...)
const currentCategory = Astro.params?.category || "blogs"; // fallback mặc định

// ✅ Lấy dữ liệu theo collection
const { recentPosts, flatCategories, flatTags } = getCategoryData(currentCategory);
---

<div class="sidebar-content">

  <!-- Recent Posts Section -->
  {recentPosts.length > 0 && (
    <section class="recent-posts">
      <h3 class="section-title">Recent {currentCategory} Posts</h3>
      <ul class="post-list">
        {recentPosts.map((post) => (
          <li class="post-item">
            <a
              href={`${base}${currentCategory}/${post.file.split('/').pop()?.replace(/\.(md|mdx)$/, '')}`}
              class="post-link"
            >
              {post.frontmatter.title}
            </a>
            <time class="post-date" datetime={post.frontmatter.date}>
              {new Date(post.frontmatter.date).toLocaleDateString("vi-VN", {
                month: "short",
                day: "numeric",
                year: "numeric",
              })}
            </time>
          </li>
        ))}
      </ul>
    </section>
  )}

  <!-- Categories Section -->
  {flatCategories.length > 0 && (
    <section class="categories">
      <h3 class="section-title">Categories</h3>
      <ul class="category-list">
        {flatCategories.map((category) => (
          <li class="category-item">
            <a href={`${base}${currentCategory}/categories/${category.toLowerCase()}`} class="category-link">
              {category}
            </a>
          </li>
        ))}
      </ul>
    </section>
  )}

  <!-- Tags Section -->
  {flatTags.length > 0 && (
    <section class="categories">
      <h3 class="section-title">Tags</h3>
      <ul class="category-list">
        {flatTags.map((tag) => (
          <li class="category-item">
            <a href={`${base}${currentCategory}/tags/${tag.toLowerCase()}`} class="category-link">
              {tag}
            </a>
          </li>
        ))}
      </ul>
    </section>
  )}
</div>
