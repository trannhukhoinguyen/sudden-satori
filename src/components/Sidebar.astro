---
import { CATEGORY_MAP, TAG_MAP, CONTENT_MAP } from "../utils/getMarkdownContent";
import "@/styles/sidebar.css";

const { collection } = Astro.props;

// fallback an toàn
const postsData = CONTENT_MAP[collection] || { posts: [], recentPosts: [] };
const categoriesData = CATEGORY_MAP[collection] || { categories: [], flatCategories: [] };
const tagsData = TAG_MAP[collection] || { tags: [], flatTags: [] };

const { recentPosts } = postsData;
const { flatCategories } = categoriesData;
const { flatTags } = tagsData;

const base = import.meta.env.BASE_URL;
---

<div class="sidebar-content">
  <!-- Recent Posts Section -->
  {recentPosts?.length > 0 && (
      <section class="recent-posts">
        <h3 class="section-title">Bài viết mới</h3>
        <ul class="post-list">
          {recentPosts.map(post => (
              <li class="post-item">
                <a
                    href={`${base}${post.frontmatter.type}/${post.file.split('/').pop()?.replace(/\.(md|mdx)$/, '')}`}
                    class="post-link"
                >
                  {post.frontmatter.title}
                </a>
                <time class="post-date" datetime={post.frontmatter.date}>
                  {new Date(post.frontmatter.date).toLocaleDateString("vi-VN", {
                    year: "numeric",
                    month: "long",
                    day: "numeric"
                  })}
                </time>
              </li>
          ))}
        </ul>
      </section>
  )}

  <!-- Categories Section -->
  {flatCategories?.length > 0 && (
      <section class="categories">
        <h3 class="section-title">Chuyên mục</h3>
        <ul class="category-list">
          {flatCategories.map((category: any) => (
              <li class="category-item">
                <a href={`${base}categories/${category.toLowerCase()}`} class="category-link">
                  {category}
                </a>
              </li>
          ))}
        </ul>
      </section>
  )}

  <!-- Tags Section -->
  {flatTags?.length > 0 && (
      <section class="tags">
        <h3 class="section-title">Thẻ</h3>
        <ul class="tag-list">
          {flatTags.map((tag: any)  => (
              <li class="tag-item">
                <a href={`${base}tags/${tag.toLowerCase()}`} class="tag-link">
                  {tag}
                </a>
              </li>
          ))}
        </ul>
      </section>
  )}
</div>
